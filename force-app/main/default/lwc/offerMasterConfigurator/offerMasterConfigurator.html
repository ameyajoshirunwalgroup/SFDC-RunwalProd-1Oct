<template>

    <div class="slds-grid slds-gutters slds-m-top_medium">
        <div class="slds-col slds-size_1-of-3">
        <lightning-record-picker
                label="Project"
                placeholder="Search Project..."
                object-api-name="Project__c"
                onchange={handleProjectChange}>
        </lightning-record-picker>
        </div>

        <div class="slds-col slds-size_1-of-3">
            <div class="slds-form-element">
                <label class="slds-form-element__label">Towers</label>
                <div class="slds-form-element__control">
                    

                    <lightning-input
                        type="search"
                        variant="label-hidden"
                        placeholder="Search Towers..."
                        onchange={handleTowerSearch}
                        onfocus={handleFocus}>
                    </lightning-input>
                    <template for:each={selectedTowers} for:item="tower">
                        <lightning-pill 
                            key={tower.Id} 
                            label={tower.Name} 
                            name={tower.Id} 
                            onremove={handleRemoveTower}
                            class="slds-m-around_xx-small">
                        </lightning-pill>
                    </template>

                    <template if:true={isDropdownVisible}>
                        <div class="slds-dropdown slds-dropdown_fluid custom-dropdown">
                            <ul class="slds-listbox slds-listbox_vertical" role="presentation">
                                <template for:each={filteredTowers} for:item="tower">
                                    <li key={tower.Id} role="presentation" class="slds-listbox__item" onclick={handleTowerSelect} data-id={tower.Id} data-name={tower.Name}>
                                        <div class="slds-media slds-listbox__option slds-listbox__option_plain">
                                            <span class="slds-truncate">{tower.Name}</span>
                                        </div>
                                    </li>
                                </template>
                            </ul>
                        </div>
                    </template>
                </div>
            </div>
        </div>

        <div class="slds-col slds-size_1-of-3 typology-container">
            <div class="slds-form-element">
                <label class="slds-form-element__label">Typology</label>
                <div class="slds-form-element__control">

                    <lightning-input
                        type="search"
                        variant="label-hidden"
                        placeholder="Search Typology..."
                        onchange={handleTypologySearch}
                        onfocus={handleTypologyFocus}
                        onclick={stopPropagation}>
                    </lightning-input>

                    <!-- Selected pills -->
                    <!--<template for:each={selectedTypologies} for:item="typology">-->
                    <template for:each={selectedTypologyLabels} for:item="typology">
                        <lightning-pill
                            key={typology.value}
                            label={typology.label}
                            name={typology.value}
                            onremove={handleRemoveTypology}
                            class="slds-m-around_xx-small">
                        </lightning-pill>
                    </template>

                    <!-- Dropdown -->
                    <template if:true={isTypologyDropdownVisible}>
                        <div class="slds-dropdown slds-dropdown_fluid custom-dropdown">
                            <ul class="slds-listbox slds-listbox_vertical">
                                <template for:each={filteredTypologies} for:item="typology">
                                    <li key={typology.value}
                                        class="slds-listbox__item"
                                        data-value={typology.value}
                                        onclick={handleTypologySelect}>
                                        <div class="slds-media slds-listbox__option_plain">
                                            <span class="slds-truncate">{typology.label}</span>
                                        </div>
                                    </li>
                                </template>
                            </ul>
                        </div>
                    </template>

                </div>
            </div>
        </div>

    </div>

    <!--<lightning-card title="Offers" class="slds-m-top_medium">-->
        <div class="slds-m-top_medium slds-text-align_right">
            <lightning-button
                variant="brand"
                label="Save"
                onclick={handleSave}>
            </lightning-button>
        </div>
        <div class="slds-p-around_medium">
            <template if:true={offers}>
                <lightning-datatable
                    key-field="Id"
                    data={offers}
                    columns={columns}
                    selected-rows={selectedRows}
                    onrowselection={handleRowSelection}
                >
                </lightning-datatable>
            </template>

            <template if:true={error}>
                <div class="slds-text-color_error slds-p-around_small">
                    Error loading offers
                </div>
            </template>
        </div>
    <!--</lightning-card>-->
</template>